<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionarios Bíblicos - Mishpatim</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>Cuestionarios Bíblicos</h1>
            <p>Pon a prueba tu conocimiento de las Escrituras</p>
        </header>
        
        <main>
            <div id="quiz-selection" class="quiz-selection">
                <h2>Selecciona un Cuestionario</h2>
                <div class="quiz-cards" id="quiz-cards">
                    <!-- Las tarjetas de cuestionarios se generarán dinámicamente -->
                </div>
            </div>
            
            <div id="quiz-container" class="quiz-container hidden">
                <div class="quiz-header">
                    <div class="progress-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div class="question-counter" id="question-counter">Pregunta 1 de 12</div>
                </div>
                
                <div class="question-container">
                    <h2 id="question-text"></h2>
                    <div id="options-container" class="options-container">
                        <!-- Las opciones se generarán dinámicamente -->
                    </div>
                </div>
                
                <div id="feedback" class="feedback hidden">
                    <div id="hint" class="hint"></div>
                    <div id="explanation" class="explanation"></div>
                    <button id="next-question" class="btn btn-primary">Siguiente Pregunta</button>
                </div>
                
                <div class="quiz-actions">
                    <button id="hint-btn" class="btn btn-secondary">Pista</button>
                    <button id="submit-answer" class="btn btn-primary">Responder</button>
                </div>
            </div>
            
            <div id="results" class="results hidden">
                <h2>Resultados del Cuestionario</h2>
                <div class="score-container">
                    <div class="score-circle">
                        <span id="score-percentage">0</span>%
                        <div class="score-text">Correctas</div>
                    </div>
                    <p id="score-message"></p>
                </div>
                <div class="results-details">
                    <p>Respuestas correctas: <span id="correct-answers">0</span> de <span id="total-questions">0</span></p>
                    <p>Tiempo: <span id="quiz-time">00:00</span></p>
                </div>
                <div class="results-actions">
                    <button id="restart-quiz" class="btn">Reintentar</button>
                    <button id="select-quiz" class="btn btn-primary">Elegir otro cuestionario</button>
                </div>
            </div>
        </main>
        
        <footer>
            <p>© 2026 Cuestionarios Bíblicos - Todos los derechos reservados</p>
        </footer>
    </div>
    
    <script>
        // Función para cargar la información de los cuestionarios
        async function loadQuizzesInfo() {
            const quizzesContainer = document.getElementById('quiz-cards');
            quizzesContainer.innerHTML = ''; // Limpiar contenedor

            try {
                // Cargar la lista de cuestionarios disponibles
                const listResponse = await fetch('data/quizzes-list.json');
                const availableQuizzes = await listResponse.json();

                for (const quizFile of availableQuizzes) {
                    try {
                        const response = await fetch(`data/${quizFile}`);
                        const data = await response.json();
                        
                        // Extraer información del cuestionario
                        const quizName = extractQuizName(quizFile);
                        const questionCount = data.length;
                        
                        // Crear tarjeta del cuestionario
                        const quizCard = document.createElement('div');
                        quizCard.className = 'quiz-card';
                        quizCard.innerHTML = `
                            <h3>${quizName}</h3>
                            <p>${questionCount} preguntas disponibles</p>
                            <button class="start-quiz">Comenzar</button>
                        `;
                        
                        // Agregar evento de clic
                        quizCard.addEventListener('click', () => {
                            startQuiz(quizFile);
                        });
                        
                        quizzesContainer.appendChild(quizCard);
                    } catch (error) {
                        console.error(`Error al cargar ${quizFile}:`, error);
                    }
                }
            } catch (error) {
                console.error('Error al cargar la lista de cuestionarios:', error);
                quizzesContainer.innerHTML = '<p>No se pudieron cargar los cuestionarios. Inténtalo más tarde.</p>';
            }
        }

        // Función para extraer el nombre del cuestionario del archivo
        function extractQuizName(filename) {
            // Eliminar 'cuestionario-' y '.json'
            const name = filename.replace('cuestionario-', '').replace('.json', '');
            // Capitalizar primera letra
            return name.charAt(0).toUpperCase() + name.slice(1);
        }

        // Función para iniciar un cuestionario
        function startQuiz(quizFile) {
            fetch(`data/${quizFile}`)
                .then(response => response.json())
                .then(data => {
                    // Guardar los datos en sessionStorage
                    sessionStorage.setItem('quizData', JSON.stringify(data));
                    // Redirigir a la página del cuestionario
                    window.location.href = 'quiz.html';
                })
                .catch(error => {
                    console.error('Error al cargar el cuestionario:', error);
                    alert('No se pudo cargar el cuestionario. Por favor, inténtalo de nuevo.');
                });
        }

        // Cargar los cuestionarios cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            loadQuizzesInfo();
        });
    </script>
</body>
</html>
